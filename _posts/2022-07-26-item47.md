---
title:  "반환 타입으로는 스트림보다 컬렉션이 낫다"
excerpt: \[Effective Java\] 반환 타입으로는 스트림보다 컬렉션이 낫다
categories:
  - effectiveJava
---

자바 7까지는 일련의 원소를 반환하는 메서드의 반환 타입으로 Collection, Set, List 같은 컬렉션 인터페이스, 혹은 Iterable이나 배열을 썼다. 이 중 가장 적합한 타입을 선택하기란 그다지 어렵지 않았다. 기본은 컬렉션 인터페이스다. for-each 문에서만 쓰이거나 반환된 원소 시퀀스가 일부 Collection 메서드를 구현할 수 없을 때는 Iterable 인터페이스를 썼다. 반환 원소들이 기본 타입이거나 성능에 민감한 상황이라면 배열을 썼다. 그런데 자바 8이 스트림이라는 개념을 들고 오면서 이 선택이 아주 복잡한 일이 되어버렸다.

스트림과 반복을 알맞게 조합해야 좋은 코드가 나온다. API를 스트림만 반환하도록 짜놓으면 반환된 스트림을 for-each로 반복하길 원하는 사용자가 불편할 것이다.

> Stream 인터페이스는 Iterable 인터페이스가 정의한 추상 메서드를 전부 포함할 뿐 아니라, Iterable 인터페이스가 정의한 방식대로 동작한다. 그럼에도 for-each로 스트림을 반복할 수 없는 까닭은 바로 Stream이 Iterable을 확장(extend)하지 않아서다.

#### 스트림을 반복하기 위한 잘못된 우회 방법
  
```java
for(ProcessHandle ph : (Iterable<ProcessHandle>)
                        ProcessHandle.allProcesses()::iterator) {
    ...
}
```  

메서드 참조를 매개변수화된 Iterable로 형변환 했다. 작동은 하지만 실전에 쓰기에는 너무 난잡하고 직관성이 떨어진다. 어댑터 메서드를 사용하면 상황이 나아진다.

#### Stream\<E\>를 Iterable\<E\>로 중개해주는 어댑터

  
```java
public static <E> Iterable<E> iterableOf(Stream<E> stream) {
    return stream::iterator;
}
```  

  
```java
for(ProcessHandle ph : iterableOf(ProcessHandle.allProcesses())) {
    ...
}
```  

어댑터를 사용하면 어떤 스트림도 for-each문으로 반복할 수 있다.

#### Iterable\<E\>를 Stream\<E\>로 중개해주는 어댑터

  
```java
public static <E> Stream<E> streamOf(Iterable<E> iterable) {
    return StreamSupport.stream(iterable.spliterator(), false);
}
```  

객체 시퀀스를 반환하는 메서드를 작성하는데, 이 메서드가 오직 스트림 파이프라인에서만 쓰인 걸 안다면 스트림을 반환하자. 반대로 반환된 객체들이 반복문에서만 쓰인 걸 안다면 Iterable을 반환하자. 하지만 공개 API를 작성할 때는 스트림 파이프라인을 사용하는 사람과 반복문에서 쓰려는 사람 모두를 배려해야 한다.
