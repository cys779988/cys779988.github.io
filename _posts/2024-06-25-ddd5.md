---
title:  "DDD 도메인 서비스"
excerpt: DDD(Domain Driven Design) 도메인 서비스
categories:
  - ddd
---

## 도메인 서비스
한 애그리거트에 넣기 애매한 도메인 기능을 억지로 특정 애그리거트에 구현하면 안 된다.
- 코드가 길어지고 외부에 대한 의존이 높아지게 되며 코드를 복잡하게 만들어 수정을 어렵게 만든다. 
- 도메인 개념이 명시적으로 드러나지 않게 된다.

이런 경우에 도메인 기능을 별도 서비스로 구현하자.

#### 도메인 서비스 특징
- 도메인 서비스는 도메인 영역에 위치한 도메인 로직을 표현할 때 사용한다.
- 도메인 서비스는 애그리거트나 밸류와 비교할 때 상태 없이 로직만 구현한다는 점에서 다르다.
- 도메인 서비스를 사용하는 주체는 애그리거트가 될 수도 있고 응용 서비스가 될 수도 있다.
- 특정 기능이 응용 서비스인지 도메인 서비스인지 애매할 때는 해당 로직이 애그리거트의 상태를 변경하거나 상태 값을 계산한다면 도메인 로직으로 판단하면 된다.

#### 외부 시스템 연동과 도메인 서비스
외부 시스템이나 타 도메인과의 연동 기능도 도메인 서비스가 될 수 있다. 예를 들어 HTTP API 호출을 통해서만 확인할 수 있는 정보가 있을 때, 특정 도메인 입장에서는 도메인 로직이 될 수 있다.  
중요한 점은 시스템 연동 관점에서 인터페이스를 작성하는 것이 아니라 도메인 로직 관점에서 인터페이스를 작성해야 한다는 것이다.

  
```java
public interface SurveyPermissionChecker {
    boolean hasUserCreationPermission(String userId);
}

public class CreateSurveyService {
    private SurveyPermissionChecker surveyPermissionChecker;
    
    public Long createSurvey(CreateSurveyRequest request) {
        validate(request);
        
        // 도메인 서비스를 이용해서 외부 시스템 연동을 표현
        if (!surveyPermissionChecker.hasUserCreationPermission(request.getUserId())) {
            throw new BadRequestException();
        }
    }
    
    ...
}
```  

#### 도메인 서비스 패키지 위치
도메인 서비스는 다른 도메인 구성요소와 동일한 패키지에 위치시킨다. 도메인 서비스 개수가 많거나 다른 구성요소(엔티티, 밸류)와 명시적으로 구분하고자 할 때는 `domain.model`, `domain.service`, `domain.repository`와 같이 하위 패키지를 구분하자.

#### 도메인 서비스의 인터페이스와 클래스
- 도메인 서비스의 로직이 고정되어 있지 않은 경우 도메인 서비스 자체를 인터페이스로 구현하고 이를 구현한 클래스를 둘 수도 있다. 특히 외부 시스템이나 별도 엔진을 이용해서 구현할 때 인터페이스와 클래스를 분리하게 된다.
- 도메인 영역에는 도메인 서비스 인터페이스가 위치하고 실제 구현은 인프라스트럭처 영역에 위치시킬 수 있다. 이를 통해 도메인 영역이 특정 구현에 종속되는 것을 방지할 수 있고 테스트가 쉬워진다.

###### Reference
- 도메인 주도 개발 시작하기, 최범균 지음